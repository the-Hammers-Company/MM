<?xml version="1.0" encoding="UTF-8"?>
<!--
    GSC-18128-1, "Core Flight Executive Version 6.7"
    LEW-19710-1, "CCSDS electronic data sheet implementation"

    Copyright (c) 2006-2019 United States Government as represented by
    the Administrator of the National Aeronautics and Space Administration.
    All Rights Reserved.

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

    This document adheres to the Electronic Data Sheet (EDS) XML schema
    as prescribed in CCSDS book 876.0.

    Purpose:
      This describes all interface objects for the Memory Manager (MM)
      core application
-->
<PackageFile xmlns="http://www.ccsds.org/schema/sois/seds">
    <Package name="MM" shortDescription="Memory Manager Application Package">
        <DataTypeSet>
            <!-- DEFINES -->

            <AliasDataType name="MemAddress" type="BASE_TYPES/MemReference" shortDescription="Reference to Memory Address" />
            <AliasDataType name="MemSize" type="BASE_TYPES/uint32" shortDescription="Reference to Memory Size" />

            <!-- STRINGS -->

            <StringDataType name="SymName" length="${CFE_MISSION/CORE_API_MAX_API_LEN}" shortDescription="Symbol name string"/>

            <!-- TYPEDEFS -->

            <ContainerDataType name="SymAddr" shortDescription="Symbolic Address Type">
                <EntryList>
                    <Entry name="Offset" type="MemAddress">
                        <LongDescription>
                            Optional offset that is used as the
                            absolute address if the SymName string is NUL
                        </LongDescription>
                    </Entry>
                    <Entry name="SymName" type="SymName" shortDescription="Symbol name string"/>
                </EntryList>
            </ContainerDataType>

            <!-- ENUMS -->

            <EnumeratedDataType name="LastAction" shortDescription="Last Action Identifiers">
                <EnumerationList>
                    <Enumeration label="NOACTION"        value="0"  shortDescription="Used to clear out HK action variable" />
                    <Enumeration label="PEEK"            value="1"  shortDescription="Peek action" />
                    <Enumeration label="POKE"            value="2"  shortDescription="Poke action" />
                    <Enumeration label="LOAD_FROM_FILE"  value="3"  shortDescription="Load from file action" />
                    <Enumeration label="LOAD_WID"        value="4"  shortDescription="Load with interrupts disabled action" />
                    <Enumeration label="DUMP_TO_FILE"    value="5"  shortDescription="Dump to file action" />
                    <Enumeration label="DUMP_INEVENT"    value="6"  shortDescription="Dump in event action" />
                    <Enumeration label="FILL"            value="7"  shortDescription="Fill action" />
                    <Enumeration label="SYM_LOOKUP"      value="8"  shortDescription="Symbol lookup action" />
                    <Enumeration label="SYMTBL_SAVE"     value="9"  shortDescription="Dump symbol table to file action" />
                    <Enumeration label="EEPROMWRITE_ENA" value="10" shortDescription="EEPROM write enable action" />
                    <Enumeration label="EEPROMWRITE_DIS" value="11" shortDescription="EEPROM write disable action" />
                    <Enumeration label="NOOP"            value="12" shortDescription="No-op action" />
                    <Enumeration label="RESET"           value="13" shortDescription="Reset counters action" />
                </EnumerationList>
                <IntegerDataEncoding sizeInBits="8" encoding="unsigned"/>
            </EnumeratedDataType>

            <EnumeratedDataType name="MemType" shortDescription="Memory Types">
                <EnumerationList>
                    <Enumeration label="NOMEMTYPE" value="0" shortDescription="Used to indicate that no memtype specified"/>
                    <Enumeration label="RAM" value="1" shortDescription="Normal RAM, no special access required"/>
                    <Enumeration label="EEPROM" value="2" shortDescription="EEPROM, requires special access for writes"/>
                    <Enumeration label="MEM8" value="3" shortDescription="Optional memory type that is only 8-bit read/write"/>
                    <Enumeration label="MEM16" value="4" shortDescription="Optional memory type that is only 16-bit read/write"/>
                    <Enumeration label="MEM32" value="5" shortDescription="Optional memory type that is only 32-bit read/write"/>
                </EnumerationList>
                <!-- This does not need 32 bits, but this makes it match the previous definition -->
                <IntegerDataEncoding sizeInBits="32" encoding="unsigned"/>
            </EnumeratedDataType>

            <!-- ARRAYS -->

            <ArrayDataType name="DataArray" dataTypeRef="BASE_TYPES/uint8" shortDescription="Data to be loaded">
                <DimensionList>
                    <Dimension size="${MM/MAX_UNINTERRUPTIBLE_DATA}"/>
                </DimensionList>
            </ArrayDataType>

            <!-- FILE HEADER -->

            <ContainerDataType name="LoadDumpFileHeader" shortDescription="Load and Dump file header structure">
                <EntryList>
                    <Entry name="SymAddress" type="SymAddr" shortDescription="Symbolic load address or fully resolved dump address" />
                    <Entry name="NumOfBytes" type="MemSize" shortDescription="Bytes to load or bytes dumped" />
                    <Entry name="Crc" type="BASE_TYPES/uint32" shortDescription="CRC value for load or dump data" />
                    <Entry name="MemType" type="MemType" shortDescription="Memory type used" />
                    <PaddingEntry sizeInBits="24" />
                </EntryList>
            </ContainerDataType>

            <!-- PAYLOADS -->

            <ContainerDataType name="PeekCmd_Payload" shortDescription="Memory Peek Command Payload">
                <EntryList>
                    <Entry name="DataSize" type="MemSize" shortDescription="Size of the data to be read"/>
                    <Entry name="MemType" type="MemType" shortDescription="Memory type to peek data from"/>
                    <Entry name="SrcSymAddress" type="SymAddr" shortDescription="Symbolic source peek address"/>
                </EntryList>
            </ContainerDataType>

            <ContainerDataType name="PokeCmd_Payload" shortDescription="Memory Poke Command Payload">
                <EntryList>
                    <Entry name="DataSize" type="MemSize" shortDescription="Size of the data to be written"/>
                    <Entry name="MemType" type="MemType" shortDescription="Memory type to poke data to"/>
                    <Entry name="Data" type="BASE_TYPES/uint32" shortDescription="Data to be written"/>
                    <PaddingEntry sizeInBits="32" />
                    <Entry name="DestSymAddress" type="SymAddr" shortDescription="Symbolic destination poke address"/>
                </EntryList>
            </ContainerDataType>

            <ContainerDataType name="LoadMemWIDCmd_Payload" shortDescription="Memory Load With Interrupts Disabled Command Payload">
                <EntryList>
                    <Entry name="NumOfBytes" type="BASE_TYPES/uint8" shortDescription="Number of bytes to be loaded"/>
                    <PaddingEntry sizeInBits="24" />
                    <Entry name="Crc" type="BASE_TYPES/uint32" shortDescription="Data check value"/>
                    <Entry name="DestSymAddress" type="SymAddr" shortDescription="Symbolic destination load address"/>
                    <Entry name="DataArray" type="DataArray" shortDescription="Data to be loaded"/>
                </EntryList>
            </ContainerDataType>

            <ContainerDataType name="DumpInEventCmd_Payload" shortDescription="Dump Memory In Event Message Command Payload">
                <EntryList>
                    <Entry name="MemType" type="MemType" shortDescription="Memory dump type"/>
                    <Entry name="NumOfBytes" type="BASE_TYPES/uint8" shortDescription="Number of bytes to be dumped"/>
                    <PaddingEntry sizeInBits="24" />
                    <Entry name="SrcSymAddress" type="SymAddr" shortDescription="Symbolic source address"/>
                </EntryList>
            </ContainerDataType>

            <ContainerDataType name="LoadMemFromFileCmd_Payload" shortDescription="Memory Load From File Command Payload">
                <EntryList>
                    <Entry name="FileName" type="BASE_TYPES/PathName" shortDescription="Name of memory load file"/>
                </EntryList>
            </ContainerDataType>

            <ContainerDataType name="DumpMemToFileCmd_Payload" shortDescription="Memory Dump To File Command Payload">
                <EntryList>
                    <Entry name="MemType" type="MemType" shortDescription="Memory dump type"/>
                    <Entry name="NumOfBytes" type="MemSize" shortDescription="Number of bytes to be dumped"/>
                    <Entry name="SrcSymAddress" type="SymAddr" shortDescription="Symbol plus optional offset"/>
                    <Entry name="FileName" type="BASE_TYPES/PathName" shortDescription="Name of memory dump file"/>
                </EntryList>
            </ContainerDataType>

            <ContainerDataType name="FillMemCmd_Payload" shortDescription="Memory Fill Command Payload">
                <EntryList>
                    <Entry name="MemType" type="MemType" shortDescription="Memory type"/>
                    <Entry name="NumOfBytes" type="MemSize" shortDescription="Number of bytes to fill"/>
                    <Entry name="FillPattern" type="BASE_TYPES/uint32" shortDescription="Fill pattern to use"/>
                    <PaddingEntry sizeInBits="32" />
                    <Entry name="DestSymAddress" type="SymAddr" shortDescription="Symbol plus optional offset"/>
                </EntryList>
            </ContainerDataType>

            <ContainerDataType name="LookupSymCmd_Payload" shortDescription="Symbol Table Lookup Command Payload">
                <EntryList>
                    <Entry name="SymName" type="SymName" shortDescription="Symbol name string"/>
                </EntryList>
            </ContainerDataType>

            <ContainerDataType name="SymTblToFileCmd_Payload" shortDescription="Save Symbol Table To File Command Payload">
                <EntryList>
                    <Entry name="FileName" type="BASE_TYPES/PathName" shortDescription="Name of symbol dump file"/>
                </EntryList>
            </ContainerDataType>

            <ContainerDataType name="EepromWriteEnaCmd_Payload" shortDescription="EEPROM Write Enable Command Payload">
                <EntryList>
                    <Entry name="Bank" type="BASE_TYPES/uint32" shortDescription="EEPROM bank number to write-enable"/>
                </EntryList>
            </ContainerDataType>

            <ContainerDataType name="EepromWriteDisCmd_Payload" shortDescription="EEPROM Write Disable Command Payload">
                <EntryList>
                    <Entry name="Bank" type="BASE_TYPES/uint32" shortDescription="EEPROM bank number to write-disable"/>
                </EntryList>
            </ContainerDataType>

            <ContainerDataType name="HkTlm_Payload" shortDescription="Housekeeping Packet Payload Structure">
                <EntryList>
                    <Entry name="CmdCounter" type="BASE_TYPES/uint8" shortDescription="MM Application Command Counter"/>
                    <Entry name="ErrCounter" type="BASE_TYPES/uint8" shortDescription="MM Application Command Error Counter"/>
                    <Entry name="LastAction" type="LastAction" shortDescription="Last command action executed"/>
                    <Entry name="MemType" type="MemType" shortDescription="Memory type for last command"/>
                    <Entry name="Address" type="MemAddress" shortDescription="Fully resolved address used for last command"/>
                    <Entry name="DataValue" type="BASE_TYPES/uint32" shortDescription="Last command data (fill pattern or peek/poke value)"/>
                    <Entry name="BytesProcessed" type="MemSize" shortDescription="Bytes processed for last command"/>
                    <Entry name="FileName" type="BASE_TYPES/PathName" shortDescription="Name of the data file used for last command, where applicable"/>
                </EntryList>
            </ContainerDataType>

            <!-- COMMANDS -->

            <ContainerDataType name="CommandBase" baseType="CFE_HDR/CommandHeader"/>

            <ContainerDataType name="SendHkCmd" baseType="CommandBase" shortDescription="Housekeeping Request command packet structure"/>

            <ContainerDataType name="NoopCmd" baseType="CommandBase">
                <ConstraintSet>
                    <ValueConstraint entry="Sec.FunctionCode" value="0"/>
                </ConstraintSet>
            </ContainerDataType>

            <ContainerDataType name="ResetCountersCmd" baseType="CommandBase">
                <ConstraintSet>
                    <ValueConstraint entry="Sec.FunctionCode" value="1"/>
                </ConstraintSet>
            </ContainerDataType>

            <ContainerDataType name="PeekCmd" baseType="CommandBase">
                <ConstraintSet>
                    <ValueConstraint entry="Sec.FunctionCode" value="2"/>
                </ConstraintSet>

                <EntryList>
                    <Entry type="PeekCmd_Payload" name="Payload"/>
                </EntryList>
            </ContainerDataType>

            <ContainerDataType name="PokeCmd" baseType="CommandBase">
                <ConstraintSet>
                    <ValueConstraint entry="Sec.FunctionCode" value="3"/>
                </ConstraintSet>

                <EntryList>
                    <Entry type="PokeCmd_Payload" name="Payload"/>
                </EntryList>
            </ContainerDataType>

            <ContainerDataType name="LoadMemWIDCmd" baseType="CommandBase">
                <ConstraintSet>
                    <ValueConstraint entry="Sec.FunctionCode" value="4"/>
                </ConstraintSet>

                <EntryList>
                    <Entry type="LoadMemWIDCmd_Payload" name="Payload"/>
                </EntryList>
            </ContainerDataType>

            <ContainerDataType name="DumpInEventCmd" baseType="CommandBase">
                <ConstraintSet>
                    <ValueConstraint entry="Sec.FunctionCode" value="5"/>
                </ConstraintSet>

                <EntryList>
                    <Entry type="DumpInEventCmd_Payload" name="Payload"/>
                </EntryList>
            </ContainerDataType>

            <ContainerDataType name="LoadMemFromFileCmd" baseType="CommandBase">
                <ConstraintSet>
                    <ValueConstraint entry="Sec.FunctionCode" value="6"/>
                </ConstraintSet>

                <EntryList>
                    <Entry type="LoadMemFromFileCmd_Payload" name="Payload"/>
                </EntryList>
            </ContainerDataType>

            <ContainerDataType name="DumpMemToFileCmd" baseType="CommandBase">
                <ConstraintSet>
                    <ValueConstraint entry="Sec.FunctionCode" value="7"/>
                </ConstraintSet>

                <EntryList>
                    <Entry type="DumpMemToFileCmd_Payload" name="Payload"/>
                </EntryList>
            </ContainerDataType>

            <ContainerDataType name="FillMemCmd" baseType="CommandBase">
                <ConstraintSet>
                    <ValueConstraint entry="Sec.FunctionCode" value="8"/>
                </ConstraintSet>

                <EntryList>
                    <Entry type="FillMemCmd_Payload" name="Payload"/>
                </EntryList>
            </ContainerDataType>

            <ContainerDataType name="LookupSymCmd" baseType="CommandBase">
                <ConstraintSet>
                    <ValueConstraint entry="Sec.FunctionCode" value="9"/>
                </ConstraintSet>

                <EntryList>
                    <Entry type="LookupSymCmd_Payload" name="Payload"/>
                </EntryList>
            </ContainerDataType>

            <ContainerDataType name="SymTblToFileCmd" baseType="CommandBase">
                <ConstraintSet>
                    <ValueConstraint entry="Sec.FunctionCode" value="10"/>
                </ConstraintSet>

                <EntryList>
                    <Entry type="SymTblToFileCmd_Payload" name="Payload"/>
                </EntryList>
            </ContainerDataType>

            <ContainerDataType name="EepromWriteEnaCmd" baseType="CommandBase">
                <ConstraintSet>
                    <ValueConstraint entry="Sec.FunctionCode" value="11"/>
                </ConstraintSet>

                <EntryList>
                    <Entry type="EepromWriteEnaCmd_Payload" name="Payload"/>
                </EntryList>
            </ContainerDataType>

            <ContainerDataType name="EepromWriteDisCmd" baseType="CommandBase">
                <ConstraintSet>
                    <ValueConstraint entry="Sec.FunctionCode" value="12"/>
                </ConstraintSet>

                <EntryList>
                    <Entry type="EepromWriteDisCmd_Payload" name="Payload"/>
                </EntryList>
            </ContainerDataType>

            <!-- PACKETS -->

            <ContainerDataType name="HkTlm" baseType="CFE_HDR/TelemetryHeader">
                <EntryList>
                    <Entry type="HkTlm_Payload" name="Payload"/>
                </EntryList>
            </ContainerDataType>
        </DataTypeSet>

        <ComponentSet>
            <Component name="Application">
                <RequiredInterfaceSet>
                    <Interface name="CMD" shortDescription="Software bus telecommand interface" type="CFE_SB/Telecommand">
                        <GenericTypeMapSet>
                            <GenericTypeMap name="TelecommandDataType" type="CommandBase" />
                        </GenericTypeMapSet>
                    </Interface>

                    <Interface name="SEND_HK" shortDescription="Send telemetry command interface" type="CFE_SB/Telecommand">
                        <GenericTypeMapSet>
                            <GenericTypeMap name="TelecommandDataType" type="SendHkCmd" />
                        </GenericTypeMapSet>
                    </Interface>

                    <Interface name="HK_TLM" shortDescription="Software bus housekeeping telemetry interface" type="CFE_SB/Telemetry">
                        <GenericTypeMapSet>
                            <GenericTypeMap name="TelemetryDataType" type="HkTlm" />
                        </GenericTypeMapSet>
                    </Interface>
                </RequiredInterfaceSet>

                <Implementation>
                    <VariableSet>
                        <Variable type="BASE_TYPES/uint16" readOnly="true" name="CmdTopicId" initialValue="${CFE_MISSION/MM_CMD_TOPICID}"/>
                        <Variable type="BASE_TYPES/uint16" readOnly="true" name="SendHkTopicId" initialValue="${CFE_MISSION/MM_SEND_HK_TOPICID}"/>
                        <Variable type="BASE_TYPES/uint16" readOnly="true" name="HkTlmTopicId" initialValue="${CFE_MISSION/MM_HK_TLM_TOPICID}"/>
                    </VariableSet>

                    <ParameterMapSet>
                        <ParameterMap interface="CMD" parameter="TopicId" variableRef="CmdTopicId" />
                        <ParameterMap interface="SEND_HK" parameter="TopicId" variableRef="SendHkTopicId" />
                        <ParameterMap interface="HK_TLM" parameter="TopicId" variableRef="HkTlmTopicId" />
                    </ParameterMapSet>
                </Implementation>
            </Component>
        </ComponentSet>
    </Package>
</PackageFile>